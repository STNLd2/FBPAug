from functools import partial

from dpipe.dataset.wrappers import cache_methods, apply
from fbp_aug.dataset import normalize_ct, Dataset
from fbp_aug.path import cancer500_data_path

min_clip = -1350
max_clip = 150

data_path = cancer500_data_path
modalities = ['CT']

dataset_to_test = cache_methods(
    instance=apply(
        instance=Dataset(
            data_path=data_path,
            modalities=modalities,
            new_spacing=(1, 1, None)
        ),
        load_image=partial(normalize_ct, min_clip=min_clip, max_clip=max_clip)
    ),
    methods=['image', 'lungs']
)

ids_to_test = dataset_to_test.ids

load_x_to_test = dataset_to_test.image
