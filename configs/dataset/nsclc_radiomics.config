from functools import partial

from dpipe.dataset.wrappers import cache_methods, apply
from fbp_aug.dataset import normalize_ct, Dataset
from fbp_aug.path import nsclc_data_path

min_clip = -1350
max_clip = 150

data_path = nsclc_data_path
modalities = ['CT']

dataset= cache_methods(
    instance=apply(
        instance=Dataset(
            data_path=data_path,
            modalities=modalities,
            new_spacing=(1, 1, None)
        ),
        load_image=partial(normalize_ct, min_clip=min_clip, max_clip=max_clip)
    ),
    methods=['image', 'lungs']
)

ids = dataset.ids
load_x = dataset.image
load_y = dataset.lungs
